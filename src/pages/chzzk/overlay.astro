---
import Footer from '@/components/Footer.astro'
import Header from '@/components/Header.astro'
import Layout from '@/layouts/Layout.astro'
import {checkSignedIn, createSession} from '@/lib/chzzk'
import {io} from 'socket.io-client'

const isSignedIn = await checkSignedIn(Astro.cookies, Astro.locals)
const accessToken = Astro.cookies.get('accessToken')

if (!isSignedIn) {
  return Astro.redirect('/chzzk')
}

if (accessToken) {
  const session = await createSession(accessToken.value)
  const socketOption = {
    reconnection: false,
    'force new connection': true,
    'connect timeout': 3000,
    transports: ['websocket'],
  }
  const socket = io.connect(session.content.url, socketOption)
}
---

<Layout>
  <Header />
    <main>
      안녕하세요.
    </main>
  <Footer />
</Layout>

<style lang="sass">
  @reference '@/styles/global.css'

  main
    @apply mx-auto px-16 pt-8 container flex items-center justify-center
</style>
